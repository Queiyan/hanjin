<!DOCTYPE html>
<html lang='ko'>
<head>
    <meta charset='UTF-8'>
    <title>우편번호 검색</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        #wrap {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id='wrap'></div>
    <script src='https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js'></script>
    <script>
        // 전역 오류 핸들러 추가
        window.addEventListener('error', function (event) {
            window.chrome.webview.postMessage(JSON.stringify({
                type: 'error',
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                stack: event.error ? event.error.stack : ''
            }));
        });

        window.addEventListener('unhandledrejection', function (event) {
            window.chrome.webview.postMessage(JSON.stringify({
                type: 'unhandledrejection',
                reason: event.reason ? event.reason.stack || event.reason : ''
            }));
        });

        var element_wrap = document.getElementById('wrap');
        function execDaumPostcode() {
            new daum.Postcode({
                oncomplete: function (data) {
                    console.log('선택된 주소 데이터:', data); // 콘솔 로그 확인
                    window.chrome.webview.postMessage(JSON.stringify({
                        type: 'address',
                        zonecode: data.zonecode,
                        address: data.address
                    }));
                },
                width: '100%',
                height: '100%'
            }).embed(element_wrap);
        }
        execDaumPostcode();

        // 추가: 가상 키보드 입력 시 로그 확인
        document.activeElement.addEventListener('input', function (event) {
            console.log('입력 필드에 값이 변경되었습니다:', event.target.value);
        });

        // C#에서 호출할 수 있는 함수 추가
        window.insertText = function (text) {
            var active = document.activeElement;
            if (active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA')) {
                var start = active.selectionStart;
                var end = active.selectionEnd;
                var value = active.value;
                active.value = value.substring(0, start) + text + value.substring(end);
                active.selectionStart = active.selectionEnd = start + text.length;
                active.dispatchEvent(new Event('input')); // 변경 사항 이벤트 트리거
            }
        };
    </script>
</body>
</html>
